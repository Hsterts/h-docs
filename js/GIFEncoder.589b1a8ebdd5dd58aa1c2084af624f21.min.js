GIFEncoder=function(){for(var f=0,w={},n,o,i,g,r,_,y,d,e,h,s,c,E,t,j,v,b,m,l,O,x,p,G,Q,Y,q,K,U,W,$,C,V,B,k,I,P,R,L,N,D,T,F,M,S,A,a,z,X,H;f<256;f++)w[f]=String.fromCharCode(f);function u(){this.bin=[]}return u.prototype.getData=function(){for(var t='',n=this.bin.length,e=0;e<n;e++)t+=w[this.bin[e]];return t},u.prototype.writeByte=function(e){this.bin.push(e)},u.prototype.writeUTFBytes=function(t){for(var n=t.length,e=0;e<n;e++)this.writeByte(t.charCodeAt(e))},u.prototype.writeBytes=function(t,n,s){for(var o=s||t.length,e=n||0;e<o;e++)this.writeByte(t[e])},n={},g=null,_=-1,y=0,d=!1,j=[],v=7,b=-1,m=!1,l=!0,O=!1,x=10,p="h-docs content",G=n.setDelay=function(e){y=Math.round(e/10)},Q=n.setDispose=function(e){e>=0&&(b=e)},Y=n.setRepeat=function(e){e>=0&&(_=e)},q=n.setTransparent=function(e){g=e},K=n.setComment=function(e){p=e},U=n.addFrame=function(t,s){if(t===null||!d||e===null)throw new Error("Please call start method before calling addFrame");var n=!0;try{s?t instanceof ImageData?(h=t.data,(!sizeset||o!=t.width||i!=t.height)&&k(t.width,t.height)):t instanceof Uint8ClampedArray?t.length==o*i*4?h=t:(console.log("Please set the correct size: ImageData length mismatch"),n=!1):(console.log("Please provide correct input"),n=!1):(h=t.getImageData(0,0,t.canvas.width,t.canvas.height).data,O||k(t.canvas.width,t.canvas.height)),N(),R(),l&&(M(),A(),_>=0&&S()),D(),p!==''&&T(),F(),l||A(),z(),l=!1}catch(e){n=!1}return n},W=n.download=function(t){if(e===null||m==!1)console.log("Please call start method and add frames and call finish method before calling download");else{t=t!==void 0?t.endsWith(".gif")?t:t+".gif":"download.gif";var n=document.createElement("a");n.download=t,n.href=URL.createObjectURL(new Blob([new Uint8Array(e.bin)],{type:"image/gif"})),n.click()}},$=n.finish=function(){if(!d)return!1;var t=!0;d=!1;try{e.writeByte(59),m=!0}catch(e){t=!1}return t},C=function(){r=0,h=null,s=null,c=null,t=null,m=!1,l=!0},V=n.setFrameRate=function(e){e!=15&&(y=Math.round(100/e))},B=n.setQuality=function(e){e<1&&(e=1),x=e},k=n.setSize=function(e,t){if(d&&!l)return;o=e,i=t,o<1&&(o=320),i<1&&(i=240),O=!0},I=n.start=function(){C();var t=!0;m=!1,e=new u;try{e.writeUTFBytes("GIF89a")}catch(e){t=!1}return d=t},P=n.cont=function(){C();var t=!0;return m=!1,e=new u,d=t},R=function(){var a=s.length,l,o,i,n,h,m,f,d,e,u=a/3;c=[],l=new NeuQuant(s,a,x),t=l.process(),o=0;for(i=0;i<u;i++)n=l.map(s[o++]&255,s[o++]&255,s[o++]&255),j[n]=!0,c[i]=n;if(s=null,E=8,v=7,g!==null){r=L(g),h=t[r*3],m=t[r*3+1],f=t[r*3+2],d=[];for(e=0;e<t.length;e+=3){if(n=Math.floor(e/3),!j[n])continue;t[e]==h&&t[e+1]==m&&t[e+2]==f&&d.push(n)}for(e=0;e<c.length;e++)d.indexOf(c[e])>=0&&(c[e]=r)}},L=function(n){if(t===null)return-1;for(var m=(n&16711680)>>16,s,i,o,l,c,h=(n&65280)>>8,u=n&255,a=0,r=256*256*256,d=t.length,e=0;e<d;)s=m-(t[e++]&255),i=h-(t[e++]&255),o=u-(t[e]&255),l=s*s+i*i+o*o,c=Math.floor(e/3),j[c]&&l<r&&(r=l,a=c),e++;return a},N=function(){var c=o,n,a,r,e,t,l=i;s=[],n=h,a=0;for(r=0;r<l;r++)for(e=0;e<c;e++)t=r*c*4+e*4,s[a++]=n[t],s[a++]=n[t+1],s[a++]=n[t+2]},D=function(){e.writeByte(33),e.writeByte(249),e.writeByte(4);var n,t;g===null?(n=0,t=0):(n=1,t=2),b>=0&&(t=b&7),t<<=2,e.writeByte(0|t|0|n),a(y),e.writeByte(r),e.writeByte(0)},T=function(){e.writeByte(33),e.writeByte(254),e.writeByte(p.length),e.writeUTFBytes(p),e.writeByte(0)},F=function(){e.writeByte(44),a(0),a(0),a(o),a(i),l?e.writeByte(0):e.writeByte(128|0|0|0|v)},M=function(){a(o),a(i),e.writeByte(128|112|0|v),e.writeByte(0),e.writeByte(0)},S=function(){e.writeByte(33),e.writeByte(255),e.writeByte(11),e.writeUTFBytes("NETSCAPE2.0"),e.writeByte(3),e.writeByte(1),a(_),e.writeByte(0)},A=function(){e.writeBytes(t);for(var s=3*256-t.length,n=0;n<s;n++)e.writeByte(0)},a=function(t){e.writeByte(t&255),e.writeByte(t>>8&255)},z=function(){var t=new LZWEncoder(o,i,c,E);t.encode(e)},X=n.stream=function(){return e},H=n.setProperties=function(e,t){d=e,l=t},n}